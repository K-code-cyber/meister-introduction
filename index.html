<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-Day ê³„ì‚°ê¸° 3ì°¨ ìˆ˜ì •ë³¸</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        #dday-app {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            text-align: center;
            z-index: 10; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            position: relative;
        }
        h2 {
            color: #333;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .input-container input, .input-container button {
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        .input-container button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .input-container button:hover {
            background-color: #0056b3;
        }
        #dday-list {
            list-style: none;
            padding: 0;
        }
        #dday-list li {
            background-color: #e9ecef;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        #dday-list li:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .dday-result {
            font-weight: bold;
            color: #007bff;
        }
        .dday-text-finish {
            color: #dc3545;
            font-size: 20px;
        }
        .delete-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        .delete-btn:hover {
            color: #dc3545;
        }
        /* made by kkh ë¬¸êµ¬ë¥¼ ì˜¤ë¥¸ìª½ ì•„ë˜ì— ê³ ì • */
        #footer-note {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: #999;
            z-index: 100; /* ìµœìƒë‹¨ì— í‘œì‹œ */
        }

        /* í•˜íŠ¸ íš¨ê³¼ë¥¼ ìœ„í•œ ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ */
        #heart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* í´ë¦­ ì´ë²¤íŠ¸ê°€ í•˜íŠ¸ë¡œ ì „ë‹¬ë˜ì§€ ì•Šë„ë¡ */
            z-index: 5;
            overflow: hidden;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }
        
        /* í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
        @keyframes fall {
            0% {
                transform: translate(0, -100px) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(0, 100vh) scale(0.5);
                opacity: 0;
            }
        }

        /* í•˜íŠ¸ ìŠ¤íƒ€ì¼ */
        .heart {
            position: absolute;
            font-size: 30px;
            color: #ff69b4; /* í•«í•‘í¬ */
            animation: fall 10s linear infinite;
        }
    </style>
</head>
<body>
    
    <div id="heart-overlay"></div>

    <div id="dday-app">
        <h2>D-Day ê³„ì‚°ê¸° ğŸ“…3ì°¨ ìˆ˜ì •ë³¸</h2>
        <div class="input-container">
            <input type="text" id="event-name" placeholder="ì´ë²¤íŠ¸ ì´ë¦„ (ì˜ˆ: ì‹œí—˜, ì—¬í–‰)">
            <input type="date" id="target-date">
            <button id="add-button">D-Day ì¶”ê°€í•˜ê¸°</button>
        </div>
        
        <ul id="dday-list">
        </ul>
    </div>
    
    <div id="footer-note">
        <p>made by kkh</p>
    </div>

    <script>
        // --- í•µì‹¬ ë¡œì§: D-Day ê³„ì‚° ë° í¬ë§· ---
        function calculateAndFormatDDay(targetDateStr) {
            const targetDate = new Date(targetDateStr);
            const today = new Date();
            
            today.setHours(0, 0, 0, 0); 
            targetDate.setHours(0, 0, 0, 0);

            const timeDifference = targetDate.getTime() - today.getTime();
            const oneDay = 1000 * 60 * 60 * 24; 
            const daysDifference = Math.ceil(timeDifference / oneDay);

            if (daysDifference > 0) {
                return { text: `D-${daysDifference}`, isToday: false };
            } else if (daysDifference === 0) {
                return { text: `D-DAY ğŸ‰`, isToday: true };
            } else {
                return { text: `D+${Math.abs(daysDifference)}`, isToday: false };
            }
        }
        
        // --- í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ìƒì„±/ì œì–´ í•¨ìˆ˜ ---
        function createHeart(overlay) {
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.innerHTML = 'ğŸ’–'; 
            heart.style.left = `${Math.random() * 100}vw`; // ë¬´ì‘ìœ„ Xì¶• ìœ„ì¹˜
            heart.style.animationDelay = `-${Math.random() * 5}s`; // ë¬´ì‘ìœ„ ë”œë ˆì´
            heart.style.animationDuration = `${10 + Math.random() * 5}s`; // ë¬´ì‘ìœ„ ì†ë„
            overlay.appendChild(heart);
            
            // ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„ DOMì—ì„œ ì œê±°í•˜ì—¬ ë©”ëª¨ë¦¬ ê´€ë¦¬
            heart.addEventListener('animationend', () => {
                heart.remove();
            });
        }
        
        let heartInterval = null; // ì¸í„°ë²Œ IDë¥¼ ì €ì¥í•  ë³€ìˆ˜

        function startHeartEffect() {
            const overlay = document.getElementById('heart-overlay');
            if (!overlay) return;
            
            overlay.style.display = 'block';
            
            // ì´ë¯¸ ì‹¤í–‰ ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (heartInterval) return; 

            // 100msë§ˆë‹¤ ìƒˆë¡œìš´ í•˜íŠ¸ ìƒì„±
            heartInterval = setInterval(() => {
                createHeart(overlay);
            }, 100);
        }

        function stopHeartEffect() {
            const overlay = document.getElementById('heart-overlay');
            if (!overlay) return;
            
            overlay.style.display = 'none';
            
            if (heartInterval) {
                clearInterval(heartInterval);
                heartInterval = null;
            }
            // ê¸°ì¡´ í•˜íŠ¸ ìš”ì†Œë“¤ë„ ëª¨ë‘ ì œê±°
            overlay.innerHTML = '';
        }

        // --- í™”ë©´ í‘œì‹œ ë° DOM ì¡°ì‘ ---
        function renderDDayList() {
            const listContainer = document.getElementById('dday-list');
            listContainer.innerHTML = ''; // ëª©ë¡ì„ ë¹„ìš°ê³  ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤.
            
            const savedList = JSON.parse(localStorage.getItem('ddayList') || '[]');
            
            // 1ì›” 23ì¼ í•­ëª©ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í”Œë˜ê·¸
            let isJan23Present = false;
            
            savedList.forEach((item, index) => {
                const { text, isToday } = calculateAndFormatDDay(item.date);
                
                // 1ì›” 23ì¼(YYYY-01-23)ì¸ì§€ í™•ì¸
                if (item.date && item.date.endsWith('-01-23')) {
                    isJan23Present = true;
                }
                
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <span>${item.name} (${item.date})</span>
                    <div>
                        <span class="dday-result ${isToday ? 'dday-text-finish' : ''}">${text}</span>
                        <button class="delete-btn" data-index="${index}">ì‚­ì œ</button>
                    </div>
                `;
                listContainer.appendChild(listItem);
            });
            
            // ë Œë”ë§ í›„ í•˜íŠ¸ íš¨ê³¼ ì ìš©
            if (isJan23Present) {
                startHeartEffect();
            } else {
                stopHeartEffect();
            }
        }

        // --- LocalStorage (ì €ì¥ ë° ì‚­ì œ ê¸°ëŠ¥) ---
        function saveDDay(newDDay) {
            let list = JSON.parse(localStorage.getItem('ddayList') || '[]');
            
            list.push(newDDay);
            localStorage.setItem('ddayList', JSON.stringify(list));
            renderDDayList();
        }

        function deleteDDay(index) {
            let list = JSON.parse(localStorage.getItem('ddayList') || '[]');
            list.splice(index, 1);
            localStorage.setItem('ddayList', JSON.stringify(list));
            renderDDayList(); // ëª©ë¡ ë‹¤ì‹œ ë Œë”ë§
        }
        
        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (ë²„íŠ¼ í´ë¦­) ---
        document.addEventListener('DOMContentLoaded', function() {
            // 1. í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ ëª©ë¡ì„ í™”ë©´ì— í‘œì‹œ
            renderDDayList(); 

            // 2. ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.getElementById('add-button').addEventListener('click', function() {
                const eventName = document.getElementById('event-name').value.trim();
                const targetDateStr = document.getElementById('target-date').value;

                if (!eventName || !targetDateStr) {
                    alert("ì´ë²¤íŠ¸ ì´ë¦„ê³¼ ë‚ ì§œë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                
                // ë‚ ì§œ í¬ë§·ì´ YYYY-MM-DD í˜•ì‹ì¸ì§€ í™•ì¸ (Date ì…ë ¥ í•„ë“œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë³´í†µì€ ìœ íš¨)
                
                const newDDay = { name: eventName, date: targetDateStr };
                saveDDay(newDDay); // ì €ì¥ ë° í™”ë©´ ì—…ë°ì´íŠ¸
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('event-name').value = '';
                document.getElementById('target-date').value = '';
            });

            // 3. ì‚­ì œ ë²„íŠ¼ ìœ„ì„ ì´ë²¤íŠ¸
            document.getElementById('dday-list').addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-btn')) {
                    const index = parseInt(e.target.dataset.index);
                    deleteDDay(index);
                }
            });
        });
        
    </script>
</body>
</html>
